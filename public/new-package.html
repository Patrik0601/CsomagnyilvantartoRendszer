<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="css/style.css" />
    <title>Új csomag feladása</title>
  </head>
  <body>
    <main class="container">
      <h1>Új csomag feladása</h1>
      <form id="newPkg">
        <label>Feladó neve <input type="text" name="sender_name" required></label>
        <label>Feladó címe <input type="text" name="sender_address" required></label>
        <label>Címzett neve <input type="text" name="recipient_name" required></label>
        <label>Címzett címe <input type="text" name="recipient_address" required></label>
        <label>Tartalom <input type="text" name="content" required /></label>
        <label>Súly (kg) <input type="number" step="0.01" name="weight" required></label>
        <button type="submit">Feladás</button>
      </form>
      <div id="msg" class="msg"></div>
      <p><a href="dashboard.html">Vissza a listához</a></p>
    </main>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
      if (!getToken()) {
        location.href = "login.html";
      }
      document
        .getElementById("newPkg")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const f = e.target;
          const body = {
            sender_name: f.sender_name.value,
            sender_address: f.sender_address.value,
            recipient_name: f.recipient_name.value,
            recipient_address: f.recipient_address.value,
            content: f.content.value,
            weight: f.weight.value,
          };
          try {
            const pkg = await apiRequest("POST", "/api/packages", body);
            alert("Csomag sikeresen feladva!");
            location.href = "dashboard.html";
          } catch (err) {
            document.getElementById("msg").textContent = err.message || err;
          }
        });
    </script>
  </body>
</html>
